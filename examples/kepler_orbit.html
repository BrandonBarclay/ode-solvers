<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Sylvain Renevey">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Kepler Orbit - Ode-solvers Docs</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../index.html">Ode-solvers Docs</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../index.html">Quick reference</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li class="active">
    <a href="kepler_orbit.html">Kepler Orbit</a>
</li>
                                    
<li >
    <a href="three_body_problem.html">Three-body Problem</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../index.html">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="three_body_problem.html">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#kepler-orbit">Kepler Orbit</a></li>
            <li><a href="#problem-definition">Problem Definition</a></li>
            <li><a href="#implementation">Implementation</a></li>
            <li><a href="#results">Results</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<style scoped>img.latex-inline { vertical-align: middle; }</style>
<h1 id="kepler-orbit">Kepler Orbit</h1>
<h3 id="problem-definition">Problem Definition</h3>
<p>For this example, we consider a spacecraft on a Kepler orbit about the Earth and we want to predict its future trajectory. We assume that the elliptical orbit is described by the following classical orbital elements:</p>
<ul>
<li>Semi-major axis: a = 20,000 km</li>
<li>Eccentricity: e = 0.7</li>
<li>Inclination: i = 35째</li>
<li>Right ascension of the ascending node: &#937; = 100째</li>
<li>Argument of perigee: &#969; = 65째</li>
<li>True anomaly: &#957; = 30째</li>
</ul>
<p>The period of an orbit is given by <img class='latex-inline math-true' alt='P2pisqrtfraca3mu' id='P2pisqrtfraca3m_1' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAAAbBAMAAAAgx6RqAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAdu/diasizWZEu1QQmTJF5XQwAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABTElEQVQ4y2NgwAs4/0MBfmUMvAzEgRdEqvMhUl0AiOCYQkgZmwCI5OYCkYzKLqEJCKkUrwcIDiNEohFMVjAwFiCkLvD9QXBYgUZK2KTxgrV+Y+D4gLBpAYMhkuEMDOwMBRlg93EqMLAGINSpMZgg1MkxMLziWQB1wwKG7QeQ3M7zk0NfXykB5t0pHHIQca4VjRuA1NXQ0NBIiL7XjBxQLQ7AGNlxE8JhmoAaFukMBxgZIUwOJK8z5KOFWQwDw04WIH0AEruQZAD0aDNEGmYvSwI3QwAwYNkM0FLBVVTjOt7t4CngZ2A48Q9oLpJ4yvcNKDH1//8/jgZ2oKULgWFOTBIQh6kLYMWrLv8AJ9gmzgun8Kpj2gDxBsuGjfiTfABEHVfCzQl4s5ACJNEzSV9JwGvgP0iif0vIwwsh3u0mpE5IgLg8lJ9AnDqU2AUAtTdUWyrX8J4AAAAASUVORK5CYII='> where  <img class='latex-inline math-true' alt='mu' id='mu_2' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAKBAMAAACUK2mNAAAALVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAOrOgAAAADnRSTlMAVIlEq5lm7yLdELsydtrDr+4AAAAJcEhZcwAADsQAAA7EAZUrDhsAAAA6SURBVAjXY2AQYjBiYGBwZAgDkhUMMxgYuAq4ChgYGDcwb2hgYHVgUV7AwOkmA5RdzgACImDyIogAAPqgCB2TpUimAAAAAElFTkSuQmCC'> is the standard gravitational parameter. For the Earth, &#956; = 398600.4354 km<sup>3</sup>/s<sup>2</sup>  and thus P = 2.8149 <img class='latex-inline math-true' alt='cdot' id='cdot_3' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACBAMAAACAmBAXAAAAElBMVEX///8AAAAAAAAAAAAAAAAAAABknMCaAAAABXRSTlMAMkSJq0SfSuUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAMSURBVAjXYxBiMAEAAG4AR6fEc+MAAAAASUVORK5CYII='> 10<sup>4</sup> s = 7.82 hours. The initial position of the spacecraft expressed in Cartesian coordinates is</p>
<p><center><img class='latex-inline math-true' alt='mathbfrbeginbmatrix500724841444918136285346endbmatrixquadkm' id='mathbfrbeginbma_4' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAT0AAAASBAMAAADbOBT5AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVESr3SJ2ELuZZjKJ782brQ4LAAAACXBIWXMAAA7EAAAOxAGVKw4bAAADiUlEQVRIx+2WS2gTURSG/0kymUweJVURbQUHEQRRjNauFIxCUaqLARHFKh2LprVFiAj1TaOLgo/FiJoSRRhFKlaRuBSVtpaKtkKDLroQtC5UfCxi8YWg9ZwbY2eaSF0o3fTAzcn8955/vpy5cwngCDWJCQpv6m9WqfnV9XfQPD2tbGtCJV/Lj07Q53w0t2ucnOFPAy4rp/MIXtWBa1Aa6zjlQ25cDLnPYCfhgtjBLta4lPTft+YYiI/DFxypwjIMudMleD7ynfVOKnkFA22cHCFtDwMlRk7ncVSJYvpKeKHGKeXDp3fGN+ExOwkXDHzUWeNS0h18h8ft3wYgg1MhqOHzty+BDDwGpFYkqCGUnFFCfDPEtBhyFquAF/BxY1/YVrWkj0Bnp4Ro6w5daFxKuoNv6rh81PYoUnOhtunUNGzVPV2QkngDk1Mh30xD6GJkcZL5SkwVNj7grvIp58QuYFvSuJR1B9/90a+zh5fqRfhK+/1R9FxGMMKsFC0arCQWrdM5FfD5VUPoPFxZHGMw18deJ19TYPi6xk7sAmybRfu2iUuFbud75z/vbeuIlEWI5HMt/fzTFRUVS2x8LoQODKHhBrwJNAulAUo4CfW5xamAb7dqsC7mlCyeCLAL3xx8W1ZKw6hiJ3Khaw2DpHGp0O18X6wT847RryQk7welyPMFPB1RPKD+JdAv3r4h+JFE5Z5hTgV8lmqwnpvrC7xnMPfGFZqjf51zvmA5O5GLEKpJ06jUxbqNz0VvlT6ItXhJfJ/G7L+rqVTK9MN3L4PUQqgmsjzhjqMGyYCJnhobn1hLfHJaNVjPzUnlb5nvFm+OUT4FoWVZVJATu5Bg4SRplVQaYN3G513eBTmqZJRMnm/s870b91gZLA7BHZYFXy/C7bE1Fy3sp2SN7Z8/tv046/m51cxXBsW08S3SPSb3qRel5AIEBlFN2jkqxZj++bSqvZLpSkgRvbB/v97frXT+vabzLy5lIIX9127SjVuVCMopFXl/fUZOb0UpnkoG8+2BZD9f1qMl3Y0qcrrCLqUw5AxrXNrt3H8hvA6rVtBQp8Qx7atWhE9uP4tD19NKXz+kIQTN2pGRNLzPrDsxjZMDzzXwKo5db4VO4yE6GoEFP+oD9+s4/V4WW4LgTo2d2OUhNu/UWeNS0u18+9Ch+XS3LtX96fybgFD/2aJJvkm+/8Tnmbj/p2eKyj8BwKkqPxKLkqkAAAAASUVORK5CYII='></center></p>
<p>and velocity</p>
<p><center><img class='latex-inline math-true' alt='mathbfvbeginbmatrix0717710224107482endbmatrixquadkms' id='mathbfvbeginbma_5' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQcAAAASBAMAAACk6QYIAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZu+r3VSJMrt2RBCZIs0Y2XsZAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACvUlEQVRIx81WQWgTQRR9Sdi0293UjailHmQP3oo2UFSwFIpgVVBIlSL1UBQPqSCYXozectNCD7mIVimmol48WBTEoOKCSpH2sF6UItRcipQqpHqQtmD8/29jZ5ONt0gHPm94//2Zx878YYGqMZtDA4Y+WyfxIZB1UBhMAxGX5m0CPTWaNhg3bhJ+HE5LYJK5yvByUjWJQnteJKZSfmlqYz5Rx8QBFIFwuWwPHhboLP/wS4iPpFtZ27QmgUXmKsPLSdUicpgRiWriiW+7YBM23gFmZiSPBYHpzM4qzQLCMJOIZXGMA9ooc5UhOXAV8Vm0iUQ1cWpjGgs+fKelF3SAr6DzwgSGi1yNifswHcT2oI8D2nvVhOSkivhvcESimrig3BVXYOtPHEqqJkK9OM+TnLcwgY4aE9sQTfDxr0pYPhPrOaoi/nGfKxLVxNfQtD4TT/STiuiRAUBbRooSb7q6ug56Joq4xet7JhgKtSZ2Qc/yRlkOI+kzsZ4rgHmz0xKZamLNuvZoDGOg/eaAYivd093IoupLDBNG07IwQyrwS3DVvEQI1V+Ccynhe56uikwx0UJ32O3AEXyX5lj5TNzdyaT/Tth8J7BFNhMo/U2GZmkwf4/PHeiW+OQ3sZ4rMd/k8Nl2+0zo+88i1mvYhi3NMbRM3Ovr8B0Hdcc+wi+eCYJYCQHdESHrUVfjaB8/avm6g3NURfx2Cy9Fpphozp94oTktWS3hUnOEcIU4c6XmnVjSkjjpmSDQ7FoT9BZMDSCe6ZeAr0W9nFSNGgmcFoliIoylpGlFc+aZKWqOeVzlVu2oMvFsRzrqYAh4+PsOg1as8kC8cS6Fi7Fy+RcH9L0WaysvJuekivjL43mRKCaeI55vdiOudpvZ0AMr6LFqyDAD2bk66v9qYmIzmHA2gQnD2gxfot443pifmrf/yv4Bg5XtgMqC/fQAAAAASUVORK5CYII='></center></p>
<p>such that the initial state vector is <img class='latex-inline math-true' alt='mathbfsmathbfrmathbfvT' id='mathbfsmathbfrm_6' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAARBAMAAACbYGeCAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAiXarmUS7MlTvIt1mEM2d32APAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAwUlEQVQoz2NgwAce6SttQBVhN0Li8JiyFqxmOICqgrUBmRfBztDCUIBXBQODD7q9GCqeE1QxAUgxKpogq+j/ar0AyDj5mWFnQwQD+wMgO4yhGEg6Gxsbm4JUMH1aDzKH4w+DONCMYy+A7P6kAmQzmH7wglmzGRJAtoAA0/yPKCp+QVj6MQ0wFVVc8ii2QFXcT2OAqVBm4EY3owPIYvkEV3HYxBVZRfe3AAY5IItrLlwFlvDgQIQH2Sqq8KhAi30wBQD6zTLYw3OZywAAAABJRU5ErkJggg=='>. The equations of motion describing the evolution of the system are</p>
<p><center><img class='latex-inline math-true' alt='ddotmathbfrfracmur3mathbfr' id='ddotmathbfrfrac_7' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAAQBAMAAAC4vAEMAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAImYyRFTNdqvdELuZie/B2WtmAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAoklEQVQY02NgVDBhwAQNHFAGa0IFpizLgdUMeABvQDg+aW6BIw4QVvyXTgEMab7SswIMrP89JjKwf5cPYGA40dHR0YKQtgGT9YVfGdi/cmEargqRDljAwP4RSZjpDBAwMPwHA4Z6oK0QaTTDIQAhjQFULkCkI387YJMO2MDAOn8Ldm8vv3SKqQB3qDgmBAocxi3NWsAIshsX4DHAF+IMHHAWAM3+Lt+073WRAAAAAElFTkSuQmCC'></center></p>
<p>where  <img class='latex-inline math-true' alt='r' id='r_8' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHBAMAAAA2fErgAAAAKlBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADmU0mKAAAADXRSTlMAdpkiVEQQu4nv3atmBO5n1AAAAAlwSFlzAAAOxAAADsQBlSsOGwAAACZJREFUCNdjYFR2MmAIq2A3YDCYxsDAwLwASLBsABJMB4AEUJgBAFysBLIRNdSMAAAAAElFTkSuQmCC'> is the magnitude of <img class='latex-inline math-true' alt='mathbfr' id='mathbfr_9' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAIBAMAAADHKvg1AAAAHlBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACGjDitAAAACXRSTlMAVESr3SJ2ELtcxGYwAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAI0lEQVQI12OQnGQSwMA2LVKAgW0iOwMD21QGZEJkhgIDGAAAhfgFcH88z3sAAAAASUVORK5CYII='>. Since the crate handles first order ODEs, this system must be transformed into a state space form representation. An appropriate change of variables <img class='latex-inline math-true' alt='y1r1' id='y1r1_10' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAKBAMAAADSnconAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZokyuxBEdu8izVSZq92TJbwUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAfklEQVQI12NgVGZwZUAGNbNPgqjkcoYGMJ/nLhAkMLCFKHiCuBMWszmwCSCUc3IEMDAkMjCwfmAqkC1AMmceAwPjdQYGbgeWBMYChDkMe4FscaD4gXgGRmT1ByHirKe1UMU9IeIMDIqo4gwQ8fmsC7CKswsFMGzxRhXmdtkAANgZHPBlePv0AAAAAElFTkSuQmCC'>, <img class='latex-inline math-true' alt='y2r2' id='y2r2_11' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAKBAMAAAA5qnEkAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZokyuxBEdu8izVSZ3atTJrZtAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAl0lEQVQI12NgVGZwZUAGNbNPgqjkcoYGMJ/nHRAkMLCFKHiCuBMWszkIHkMo5+QIYGCUSWBg/cBUKRCBZM5cBoaJrA0M3A4saQeAamDmMOxjYMhhaGXgPhDPEDAXSf1BBgZWzgsMrKe1GBgeI4mDbOUzABKKDOwJDKigjIFhPusChm3cASjC3AlbGdiFAjj//0dVPv//BwC4QCZvuVgRswAAAABJRU5ErkJggg=='>, <img class='latex-inline math-true' alt='y3r3' id='y3r3_12' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAKBAMAAAA5qnEkAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZokyuxBEdu8izVSZq92TJbwUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAkElEQVQI12NgVGZwZUAGNbNPgqjkcoYGMJ/nLhAkMLCFKHiCuBMWszmISSOUc3IEMDAmbmBg/cBUsCACyZx5DAxcrA0M3A4sCQx7EOYw7AWyuQ8AUTwD91Uk9QeBeG8AA+tpLbBeOADZyvkASCgyMHAYMKCCZob5rAu4DwDdgAz2MLQysAsFsG47jao6OmcDACANJE9lkqO6AAAAAElFTkSuQmCC'>, <img class='latex-inline math-true' alt='y4dotr1v1' id='y4dotr1v1_13' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE4AAAAOBAMAAABz3DdCAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZokyuxBEdu8izVSZ3atTJrZtAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAy0lEQVQoz2NgwADcGxiIAkwHGOgAGJUZXFEEamafRFPA/QBIJZczNID5PO+AIIGBLUTBE6LgHJD/DKSAdQGQN2ExmwODGEI7J0cAA0MiknkTFjMUsAkwsH5gKuBchiQ+F2jVcyQ+awPrBrkCBm4HlgRGNYS9DPuAbHEke7kfsAUwAtUdiGfYqoak/yBMHSzYD3AzANWxntZiTUBW54mmjuGgAEgdA4Mit6DPBNTAEkcPvAKG+SBfH2MgqI5dKICB7R6qedwuaElhizcABzc12ZO1e4kAAAAASUVORK5CYII='>, <img class='latex-inline math-true' alt='y5dotr2v2' id='y5dotr2v2_14' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE8AAAAOBAMAAACcHlx8AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZokyuxBEdu8izVSZq92TJbwUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA5UlEQVQoz2NgwADcGxiIA0wHGOgDGJUZXFEEamafRFPAfQFEJ5czNIAFeO4CQQIDW4iCJ0TFWSD/GkgB6wIQd8JiNoeTsxEGcHIEMDDKJCAEJixmKBA8xsDA+oGpwP8qklXzGBgmsjYg+KwNrDsFIoCh5sCSIIBkNcNeBoYchlaE1dwX2MIOAK3hPhDPoF2GZOJBoCGcD5DC/wA3QwDQGtbTWgwMfEgKQV7hNUDWCbTwMoihyLmBbwJqmJWhhSE70EnzWRcwC/ChxXbCVlSBbdwBDOxCAQyCyqji8/9/QOFz/v/PAACccDz+iTRW4QAAAABJRU5ErkJggg=='>, <img class='latex-inline math-true' alt='y6dotr3v3' id='y6dotr3v3_15' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAE8AAAAOBAMAAACcHlx8AAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAZokyuxBEdu8izVSZq92TJbwUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA4ElEQVQoz2NgwADcGxiIA0wHGOgDGJUZXFEEamafRFPAfQFEJ5czNIAFeO4CQQIDW4iCJ0TFWSD/GkgB6wIQd8JiNofwjQgDODkCGBgTkTw+YTFDgZg0AwPrB6YCVxYkq+YxMHCxNiD4rA2sGxZEAEPNgSXZAclqhr2goDyAsJr7AlsAwx6QWDz3NWkkEw8C8d4ApPA/wM3AfRVo8mktxgVcSBIgr3A+QNYpAHYPA4Mi2wUWA7RAa0bjcxgwzAd63gHZRCDYw9CKGvsHgEHBLhTAsL0aVX90Dmq6YN12mgEAHxA81BITdTcAAAAASUVORK5CYII='> yields</p>
<p><img class='latex-inline math-true' alt='doty1y4' id='doty1y4_16' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAOBAMAAACiOzMyAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVImZZjK7EER27yLNq91MAjcAAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAnklEQVQY02NgYBBkwA6UGagBWFQZ0lEEnALYCoBU60yGBWA+810gaGDgiJzABeJuOMqRwOGAUM7NE9DGwNLAwP6BaYLvBCRz6hk0GfY0MDAmsDWwTECYwyDGkMHgBBQ3qGdgQVYvzP6BsQhojqEOqnix0IEKJqA+BhVUcQYmBxE3a4b97AdQxLk/1ADtamDgdCpgEEtEUj5FnYGh7zYADDsmgG8hUBoAAAAASUVORK5CYII='></p>
<p><img class='latex-inline math-true' alt='doty2y5' id='doty2y5_17' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAOBAMAAACiOzMyAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVImZZjK7EER27yLN3auMAT15AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAqUlEQVQY02NgYBBkwA6UGagBWFQZ0lEEnALYCoBU60yGBWA+8zsgaGDgiJzABeJuOMqR4GKBUM7NE9DGvFuAgf0D02yHKiRz6hk02f4VMDAmsHUYcBXAzWEQY8hgAUozGtQzFOxFUi8MNEGygYHdUIeB4SmSeLHQAQaGC0CGCgNnA7JDmRw2Mtxm2M9+gEGCsQDhng81DCFA9ZxOBdz//yMpn6LOwOIUAAAN4ymvlrxRHQAAAABJRU5ErkJggg=='></p>
<p><img class='latex-inline math-true' alt='doty3y6' id='doty3y6_18' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAOBAMAAACiOzMyAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVImZZjK7EER27yLNq91MAjcAAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAqUlEQVQY02NgYBBkwA6UGagBWFQZ0lEEnALYCoBU60yGBWA+810gaGDgiJzABeJuOMqR4OGIUM7NE9DGPtGBgf0D04QDVUjm1DNoshUkMDAmsDUwCCPMYRBjyAgDchkN6hkYryOpF2b/INsiwMBuqMPAsA9JvFjogA/DcSBDhYGBKwBJgsmhlyGVYT/7AUYDrgKEez7UMLAB1XM6FbBLGCIpn6LOwDhTAAAihyYCJ9xZQQAAAABJRU5ErkJggg=='></p>
<p><img class='latex-inline math-true' alt='doty4fracmur3y1' id='doty4fracmur3y1_19' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAAAQBAMAAABHHiTuAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVImZZjK7EER27yLN3auMAT15AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA1UlEQVQoz2NgYBBkwAr4GB4g8ZSxK2pmT2AgCBQZJxBWlM3cAWezqDKkY1W0UlgbLts6k2EBWJD5HRA0wNWwGjAgZDcc5Uhg8MA0iEWAASrL4cDA/oFpAvcJJFlnY2NjA4b/YACW9ZvAwJjA1sCigWkdBIBlgYoM6hnENbC5nKWJASwLVMRuqMPegFURIxsDSBakiIFBhdEleQO6ikoVcwZPEEMFpGg/+wEGBgsMY7oPCOxmDgDLAhVxOhUwcNzDMAkYJ1uAbgLJiiXiihSgKYQBHzIHAPp7OKCgHkvJAAAAAElFTkSuQmCC'></p>
<p><img class='latex-inline math-true' alt='doty5fracmur3y2' id='doty5fracmur3y2_20' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAAAQBAMAAACo3E/QAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVImZZjK7EER27yLNq91MAjcAAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA3UlEQVQoz2NgYBBkwAp4GS4gc5Wxq2pmT2AgDBQZJxChKpu5A8FhUWVIx6pqpbA2QrZ1JsMCsCjzXSBogCtiNUCW3XCUI8F6I6ZRLAIwWRcLBgb2D0wT8q8jSTsbGxsbMPwHA5DsbIcqBgbGBLYGByw2QgBQtsOAq4CB0aCeQXEGNuezNDGAZQv2AW001GFg4MOmipENKnsVxFPhFuDbgK6kUsWcwRMsy8AJdMZ+9gOsDphmdR8Q2M0cAJJlkGAsYOB0KmBwUcW0bgLDFqC7gLLcQK/iAkBziAC8KDwAHUw6Cdeg4dsAAAAASUVORK5CYII='></p>
<p><img class='latex-inline math-true' alt='doty6fracmur3y3' id='doty6fracmur3y3_21' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEkAAAAQBAMAAACo3E/QAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAVImZZjK7EER27yLNq91MAjcAAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA4ElEQVQoz2NgYBBkwAp4GS4gc5Wxq2pmT2AgDBQZJxChKpu5A8FhUWVIx6pqpbA2QrZ1JsMCsCjzXSBogCtiNUCW3XCUI6FSBNMoFgGYrIcjAwP7B6YJ6WxI0s7GxsYGDP/BACx7oIqBgTGBrTUBi40QAJRtYBAG0gb1jDccsTmfpQksy8B4HWijoQ7LAZ4CLKoY2cCyDAz7QDwVjgtsAehKKlXMGTzBsgwMXAEM+9kPMCRgmtV9QGA3M1iW0YCrgIHTqYBBciKmdRMYtgDdBZRllzDEGT/MAUREIjDdIAMAuWA5WFPcBGoAAAAASUVORK5CYII='></p>
<p>which can be numerically integrated.</p>
<h3 id="implementation">Implementation</h3>
<p>The problem is solved using the Dopri5 method. We first import the crate and bring the required modules into scope:</p>
<pre><code class="rust">extern crate ode_solvers;
use ode_solvers::*;
use ode_solvers::dopri5::*;
</code></pre>

<p>Next, two type aliases are defined:</p>
<pre><code class="rust">type State = Vector6&lt;f64&gt;;
type Time = f64;
</code></pre>

<p>and the standard gravitational parameter is defined as a global constant:</p>
<pre><code class="rust">const MU: f64 = 398600.435436;
</code></pre>

<p>The equations of motion are defined in the method <em>system</em>:</p>
<pre><code class="rust">fn system(_t: Time, y: &amp;State) -&gt; State {
    let r = (y[0]*y[0] + y[1]*y[1] + y[2]*y[2]).sqrt() ;
    let mut dy = State::zeros();
    dy[0] = y[3];
    dy[1] = y[4];
    dy[2] = y[5];
    dy[3] = -MU*y[0]/r.powi(3);
    dy[4] = -MU*y[1]/r.powi(3);
    dy[5] = -MU*y[2]/r.powi(3);
    dy
}
</code></pre>

<p>We now implement the main function. The orbital period is first calculated and the initial state is initialized. Then, a stepper is created using the Dopri5 structure. We pass in a handle to the function describing the system, the initial time, the final time, the time increment between two outputs, the initial state vector, the relative tolerance, and the absolute tolerance. The integration is launched by calling the method <em>integrate()</em> and the result is stored in <em>res</em>. Finally, a check on the outcome of the integration is performed and the outputs can be extracted.</p>
<pre><code class="rust">fn main() {
    let a: f64 = 20000.0;
    let period = 2.0*PI*(a.powi(3)/MU).sqrt();
    let y0 = State::new(-5007.248417988539, -1444.918140151374, 3628.534606178356, 0.717716656891, -10.224093784269, 0.748229399696);

    let mut stepper = Dopri5::new(system, 0.0, 5.0*period, 60.0, y0, 1.0e-10, 1.0e-10);
    let res = stepper.integrate();

    // Handle result
    match res {
        Ok(stats) =&gt; {
            stats.print();

            // Do something with the output...
            // let path = Path::new(&quot;./outputs/kepler_orbit_dopri5.dat&quot;); 
            // save(stepper.x_out(), stepper.y_out(), path);  
            // println!(&quot;Results saved in: {:?}&quot;, path);
        },
        Err(_) =&gt; println!(&quot;An error occured.&quot;),
    }
}
</code></pre>

<h3 id="results">Results</h3>
<p>The following figure shows the trajectory resulting from the integration. As expected, the orbit is closed.</p>
<p><center><img alt="Kepler orbit" src="images/kepler_orbit_dopri5.png" /></center></p>
<p>Some information on the integration process is provided in the stats variable:
<pre>
Number of function evaluations: 62835
Number of accepted steps: 10467
Number of rejected steps: 5
</pre></p>
<p>In order to assess the accuracy of the integration, we look at the specific orbital energy which is a constant of the motion. This specific energy is given by
<center><img class='latex-inline math-true' alt='varepsilonfracv22fracmur' id='varepsilonfracv_22' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAAAVBAMAAAAJGoXuAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAibsQZnZUMiKrmUTN3e+T7aaUAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAwUlEQVQoz2NgQAfciQwEQRlXAWFFloSVMAcbEFTTO6kBmTuBE10By4IwNB8sMEJXs/lAG6oAY0IqhscFilEFmBpWb0BTw7ohAVWAL2wh0HlCSkj+YA9pQFVTBXYlWMXKmTNnzsbmSzewo8KQg/U/GKAJoKmBA69Vq1YtgHGSGVDtclmNqSGAwQKZy+FghyUGlQRQw5WPcHQZ9KJwTUUWY1E0HYW340ACphJW1KBnC8BiTDYbinuwJUoOlBBkYAClHgCAWzCtfJiEBgAAAABJRU5ErkJggg=='></center>
where <img class='latex-inline math-true' alt='v' id='v_23' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHBAMAAAA2fErgAAAAKlBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADmU0mKAAAADXRSTlMAZokyVKtEdhDNIu+ZcBBLvQAAAAlwSFlzAAAOxAAADsQBlSsOGwAAACtJREFUCNdjYFRmCWBILueYwLBgMkMBA8cGDgcGlgC2BgaWAywMDAwHBRgAgEMHATrKCqYAAAAASUVORK5CYII='> is the amplitude of the velocity and <img class='latex-inline math-true' alt='r' id='r_24' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHBAMAAAA2fErgAAAAKlBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADmU0mKAAAADXRSTlMAdpkiVEQQu4nv3atmBO5n1AAAAAlwSFlzAAAOxAAADsQBlSsOGwAAACZJREFUCNdjYFR2MmAIq2A3YDCYxsDAwLwASLBsABJMB4AEUJgBAFysBLIRNdSMAAAAAElFTkSuQmCC'> is the distance from the Earth's center to the spacecraft. In theory, this value is constant as long as no external force acts on the system (which is the case here). From the intial conditions, the specific energy of this orbit is 
<center><img class='latex-inline math-true' alt='varepsilon099650km2s2' id='varepsilon09965_25' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIkAAAARBAMAAAAbP5LUAAAAMFBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAv3aB7AAAAD3RSTlMAibsQZnZUMiKrRJnd780SgMrdAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACF0lEQVQ4y61SwWvTYBT/NUnjl5p0cThEPbjtJHqJMnWCYxE6ZPYSREu3XSqzFRVcEL142CLbbsP15KynDxUvCstBhq6Xgjt5CvQg3ir6BwTUm1Bfvppi6wpafPA93vfyy4/3e78P6C+ULI/LzDb6jRU5iDIdZk/0RO1/QymR9fBgClfOmDhVdKPG1/j7S9Qp5+mkfMPqQSLxc5SPyTU2bPAjPzxsoEENMYAImdUo+1FprfUaZR06BwvxXiow5D0gwBa11XIbodFszBHlRi+WBUgm1BAjk8RA2FQN1UiR00bM0kl6UZWM9jw4uousTUg+UiGOLz0/hNxVV6nhILXTbtadG5tWp6HyeWAvcLeEm6oFJeZ4W6lUnsQskzDKkEN8XOC6x1FXGrhE7YEx6f5JX/I1vt4MgVWgkR5vNmnInItrF7pnSdiLJhm159OmpVGxQ7MMUvtVAcywdDctpEQWfV9u4XOuXJZ+I8hWq1UfpUWblnn9yxK0so2RVCD2MrMPWMMEfr0Qsuj2N1GRPNWUvC5FgC6UvhuwtAN17JBHjyLr9WXrFp7iBos+kkUK7gi0g/Gko/EuRYZbRAkfVCdR0D2HBeTmZ2oH6dN4jSFsPUPLooe4J/BnR82k+QeLMmXjMDKXgaFtrMx5OHGe3oc8rFzEUTxGUeDJIuWFHf/SUvTvsdpx69zu30e+85qZ7YvFx38Iub0S/ARGnnzAqj8UeQAAAABJRU5ErkJggg=='></center>
By computing <img class='latex-inline math-true' alt='varepsilon' id='varepsilon_26' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHBAMAAAA2fErgAAAAIVBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADdcGRXAAAACnRSTlMAibsQZnZUMiKreB2UIAAAAAlwSFlzAAAOxAAADsQBlSsOGwAAACRJREFUCNdjYBBSMmBgMWBgYGAMK4ASyUAeQwCDBQODpZIAAwA8ZgN9F8ZSdwAAAABJRU5ErkJggg=='> for each time step and plotting the difference <img class='latex-inline math-true' alt='varepsilonivarepsilon0' id='varepsilonivare_27' src='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAAKBAMAAADfg7pgAAAAKlBMVEX///8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADmU0mKAAAADXRSTlMAibsQZnZUMiKrmUTNMiULPgAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAGxJREFUCNdjYBBSMmBAAlAuC4ognMsYVsDAWAAXBnFT3CE0CHitWrVqAZjLPIGJgSEZxQwQl02AqYEhgMGCwQshDOSyBnBuYLBUEuC2QQgDuawCQGEQcEUxB2wICChvQBYGWwkCS1Dd7hLNAABXHBJPICm7rwAAAABJRU5ErkJggg=='>, we obtain the following time evolution of the error:</p>
<p><center><img alt="Time evolution of the error on the specific energy" src="images/err_specific_energy_dopri5.png" /></center></p>
<p>As can be seen on this figure, the specific energy is constant up to the 9th digit after the decimal point which shows that the accuracy of the integration is quite good. A higher accuracy can be achieved by selecting smaller values for <em>rtol</em> and <em>atol</em>.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
