<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Sylvain Renevey">
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Three-body Problem - Ode-solvers Docs</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/docco.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../index.html">Ode-solvers Docs</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="../index.html">Quick reference</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="kepler_orbit.html">Kepler Orbit</a>
</li>
                                    
<li class="active">
    <a href="three_body_problem.html">Three-body Problem</a>
</li>
                                </ul>
                            </li>
                            <li >
                                <a href="https://docs.rs/ode_solvers/">API documentation</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="kepler_orbit.html">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="disabled">
                                <a rel="prev" >
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/srenevey/ode-solvers"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#three-body-problem">Three-Body Problem</a></li>
            <li><a href="#problem-definition">Problem Definition</a></li>
            <li><a href="#implementation">Implementation</a></li>
            <li><a href="#results">Results</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="three-body-problem">Three-Body Problem</h1>
<h2 id="problem-definition">Problem Definition</h2>
<p>In this problem, we consider the circular restricted three body problem in which a spacecraft evolves under the influence of the Earth and the Moon. The second order nondimensional equations of motion of this problem are</p>
<p>
<script type="math/tex; mode=display">\ddot{x}-2\dot{y}-x = -\frac{(1-\mu)(x+\mu)}{d^3}-\frac{\mu(x-1+\mu)}{r^3}</script>
</p>
<p>
<script type="math/tex; mode=display">\ddot{y}+2\dot{x}-y = -\frac{(1-\mu)y}{d^3}-\frac{\mu y}{r^3}</script>
</p>
<p>
<script type="math/tex; mode=display">\ddot{z} = -\frac{(1-\mu)z}{d^3}-\frac{\mu z}{r^3}</script>
</p>
<p>where</p>
<p>
<script type="math/tex; mode=display">d=\left[(x+\mu)^2+y^2+z^2\right]^{\frac{1}{2}}</script>
</p>
<p>
<script type="math/tex; mode=display">r=\left[(x-1+\mu)^2+y^2+z^2\right]</script>
</p>
<p>
<script type="math/tex">\mu</script> is a parameter of the system. For the Earth-Moon system, <script type="math/tex">\mu=0.0123</script>. Rewriting this system in state space form yields</p>
<p>
<script type="math/tex; mode=display">\dot{x}_1=x_4</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{x}_2=x_5</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{x}_3=x_6</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{x}_4=x_1+2x_5-\frac{(1-\mu)(x_1+\mu)}{d^3}-\frac{\mu(x_1-1+\mu)}{r^3}</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{x}_5=-2x_4+x_2-\frac{(1-\mu)x_2}{d^3}-\frac{\mu x_2}{r^3}</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{x}_5=-\frac{(1-\mu)x_3}{d^3}-\frac{\mu x_3}{r^3}</script>
</p>
<h2 id="implementation">Implementation</h2>
<p>The problem is solved using Dop853. The crate is first imported and the modules are brought into scope:</p>
<pre><code class="Rust">extern crate ode_solvers;
use ode_solvers::*;
use ode_solvers::dop853::*;
</code></pre>

<p>Type aliases are then defined for the state vector and the time:</p>
<pre><code class="Rust">type State = Vector6&lt;f64&gt;;
type Time = f64;
</code></pre>

<p>Next, we define the problem specific <script type="math/tex">\mu</script> constant</p>
<pre><code class="Rust">const MU: f64 = 0.012300118882173;
</code></pre>

<p>and finally the ODEs to be solved:</p>
<pre><code class="Rust">fn system(_t: Time, y: &amp;State, dy: &amp;mut State) {
    let d = ((y[0]+MU).powi(2) + y[1].powi(2) + y[2].powi(2)).sqrt();
    let r = ((y[0]-1.0+MU).powi(2) + y[1].powi(2) + y[2].powi(2)).sqrt();

    dy[0] = y[3];
    dy[1] = y[4];
    dy[2] = y[5];
    dy[3] = y[0] + 2.0*y[4] - (1.0-MU)*(y[0]+MU)/d.powi(3) - MU*(y[0]-1.0+MU)/r.powi(3);
    dy[4] = -2.0*y[3] + y[1] - (1.0-MU)*y[1]/d.powi(3) - MU*y[1]/r.powi(3);
    dy[5] = -(1.0-MU)*y[2]/d.powi(3) - MU*y[2]/r.powi(3);
}
</code></pre>

<p>The intial state vector of the spacecraft is defined in the <em>main</em> function. A Dop853 structure is created and the <em>integrate()</em> function is called. The result is handled with a <em>match</em> statement.</p>
<pre><code class="Rust">fn main() {
    let y0 = State::new(-0.271, -0.42, 0.0, 0.3, -1.0, 0.0);
    let mut stepper = Dop853::new(system, 0.0, 150.0, 0.001, y0, 1.0e-14, 1.0e-14);
    let res = stepper.integrate();

    // Handle result
    match res {
        Ok(stats) =&gt; {
            stats.print();
            // Do something with the results...
            // let path = Path::new(&quot;./outputs/three_body_dop853.dat&quot;);
            // save(stepper.x_out(), stepper.y_out(), path);  
            // println!(&quot;Results saved in: {:?}&quot;, path);
        },
        Err(_) =&gt; println!(&quot;An error occured.&quot;),
    }
}
</code></pre>

<h2 id="results">Results</h2>
<p>The trajectory of the spacecraft for a duration of 150 (dimensionless time) is shown on the following figure:</p>
<p><center><img alt="Three body problem" src="images/three_body_dop853.png" /></center></p>
<p>On that figure, the Earth is located at (0, 0) and the Moon is at (0.9877, 0). We see that the spacecraft is first on an orbit about the Earth before moving to the vicinity of the Moon. The accuracy of the integration can be assessed by looking at the Jacobi constant. The Jacobi constant is given by</p>
<p><center><script type="math/tex; mode=display">C=\frac{2(1-\mu)}{d} + \frac{2\mu}{r} + x^2 +y^2 - v^2</script></center></p>
<p>and is an integral of the motion (i.e. is constant as long as no external force is applied). Based on the initial conditions, the Jacobi constant yields</p>
<p><center><script type="math/tex; mode=display">C_0=3.1830</script></center></p>
<p>By computing the Jacobi constant at each time step and plotting the difference <script type="math/tex">C-C_0</script>, we get the figure below:</p>
<p><center><img alt="Error on the Jacobi constant" src="images/err_jacobi_dop853.png" /></center></p>
<p>As can be seen on that figure, the Jacobi constant is constant up to the 11th digit after the decimal point. This accuracy is quite reasonable for that kind of problem but if a higher accuracy is required, the relative tolerance and/or the absolute tolerance could be reduced.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
